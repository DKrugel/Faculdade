---
title: "Trabalho 3 relatório"
author: "Daniel Krügel"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(astsa)
library(tidyverse)
library(seewave)
library(ggcorrplot)
```

# Questão 9

```{r}
dados <- sunspotz

A.E <- mvspec(dados, log="no")
```


```{r}
df <- A.E$details #Salvando o vetor de Espectros

df[which(df[,3] == max(df[,3])),] # plotando qual a frequencia que representa o pico observado no gráfico

```
Observamos que a frequência que representa o maior spectro no períodograma pe de 0.0917, vamos calcular a quantidade de tempo que leva para fecharmos um ciclo da sazonalidade

```{r}
(freq <- 1/0.0917)
```

Representando algo em torno de 11 anos, vamos ver se faz sentido.

```{r}
plot(dados)
```

Plotando a série temporal vemos que a cada 10 anos temos um fechamento de mais ou menos 5 ciclos, o que bate com a informação calculada de frequência.

## Intervalo de confiança

Começo retirando quantos graus de liberdade o modelo apresenta:
```{r}
A.E$df #Que ajuda que o pacote dá já salvando essa informação para a gente!
```
Vou truncar de 1.9 para 2

```{r}
#Calculando os valores de referencia da chiquadrado
qchisq(0.025, 2)
qchisq(0.975, 2)
```

Formando o vetor para o intervalo de confiança:
```{r}
c(2*(freq/qchisq(0.975, 2)) ,2*(freq/qchisq(0.025, 2))) #Pouca coisa de amplitude
```

Com um intervalo tão amplo, fica difícil de dar algum significado ao intervalo de confiança

# Questão 20

```{r}
dados <- climhyd

#Realizando as transformações pedidas no enunciado
PRECIPTRANS <- sqrt(dados$Precip)
fit01 <- sarima(PRECIPTRANS, 0,0,0, 0,1,1,12, details = F)

INFLUXTRANS <- log(dados$Inflow)
fit02 <- sarima(INFLUXTRANS, 0,0,0, 0,1,1,12, details = F)
```

```{r}
# Construindo os gráficos de Coerencia

mvspec(cbind(INFLUXTRANS, PRECIPTRANS), plot.type = "coh", spans = c(7,7))
mvspec(cbind(INFLUXTRANS, dados$CldCvr), plot.type = "coh", spans = c(7,7)) #Alguma coerencia
mvspec(cbind(INFLUXTRANS, dados$Temp), plot.type = "coh", spans = c(7,7))
mvspec(cbind(INFLUXTRANS, dados$DewPt), plot.type = "coh", spans = c(7,7))
mvspec(cbind(INFLUXTRANS, dados$WndSpd), plot.type = "coh", spans = c(7,7)) 
```

Como visto na análise gráfica podemos ver que apenas a Precipitação transformada apresenta uma coerencia próxima de 1.0, além disso a cobertura de núvens apresenta uma coesão próxima de 1.0, o que faz sentido dada a alta correlação de precipitação de chuvas e cobertura de núvens

```{r}
#Correlação
cor(PRECIPTRANS,dados$CldCvr)
#Teste de correlação
cor_pmat(cbind(PRECIPTRANS,dados$CldCvr))
```

## Ajustando uma regressão defasada

```{r}
defasada <- LagReg(INFLUXTRANS, PRECIPTRANS)
```

Como demonstrado no terceiro gráfico, a linha azul "segue" a linha pontilhada, indicando assim que o modelo utilizando a Precipitação Transformada tem um poder preditivo bom para a variável de Influxo transformado

# Questão 29

## Análise espectrais

```{r}
mvspec(prodn, log = "n")
mvspec(prodn, log = "y")
```

Para o calculo da frequencia vou seguir os mesmos passos da questão 9

```{r}
# Para produção
A.E <- mvspec(prodn, log="no")

df <- A.E$details

df[which(df[,3] == max(df[,3])),]
```

```{r}
(freq <- 1/0.032)

#Intervalo de confiança
c(2*(freq/qchisq(0.975, A.E$df)) ,2*(freq/qchisq(0.025, A.E$df))) 
```


```{r}
# Para desemprego
A.E2 <- mvspec(unemp, log="no")

df2 <- A.E2$details

df2[which(df2[,3] == max(df2[,3])),]

```

```{r}
(freq2 <- 1/0.064)

#Intervalo de confiança
c(2*(freq2/qchisq(0.975, A.E2$df)) ,2*(freq2/qchisq(0.025, A.E2$df))) 
```


## C)
```{r}
dados <- prodn
Ut <- stats::filter(dados,
                        sides = 1,
                        filter = -1,
                        init = 1,
                        method =  "recursive")


Vt <- stats::filter(Ut,
                        sides = 1,
                        filter = -1,
                        init = 12,
                        method =  "recursive")

plot(Ut, main = "prodn"); plot(Vt, main = "prodn")
```

Para produção conseguimos observar o "boom" do pós guerra na produção do país, tanto na nossa série auto regressiva Ut quando Vt

```{r}
dados <- unemp
Ut <- stats::filter(dados,
                    sides = 1,
                    filter = -1,
                    init = 1,
                    method =  "recursive")


Vt <- stats::filter(Ut,
                    sides = 1,
                    filter = -1,
                    init = 12,
                    method =  "recursive")

plot(Ut, main = "unemp")
plot(Vt, main = "unemp")
```

Para desemprego vemos dois comportamentos distintos, em Ut percebemos uma diminuição na década de 70 adiante, enquanto em Vt vemos um aumento contínuo apartir da década de 50

Não podemos afirmar que há um padrão de estacionáriedade em nenhuma dessas séries, dada a variância inconstante da base.

